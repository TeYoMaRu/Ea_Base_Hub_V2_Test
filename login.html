<!DOCTYPE html>
<html lang="th">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EABaseHub - เข้าสู่ระบบ</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- iOS -->
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="EA Base Hub">

<!-- Theme -->
<meta name="theme-color" content="#ffffff">





    <style>
        /* =====================================================
           RESET & BASE STYLES
           ===================================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Kanit', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 50%, #a5d6a7 100%);
            padding: 20px;
        }
        
        /* =====================================================
           MAIN CONTAINER - HORIZONTAL LAYOUT
           ===================================================== */
        .login-container {
            display: flex;
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15);
        }
        
        /* =====================================================
           LEFT PANEL - BRANDING
           ===================================================== */
        .brand-panel {
            flex: 1;
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        /* Decorative circles */
        .brand-panel::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            top: -100px;
            right: -100px;
        }
        
        .brand-panel::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            bottom: -50px;
            left: -50px;
        }
        
        .brand-content {
            position: relative;
            z-index: 1;
            color: white;
        }
        
        /* Logo */
        .logo-container {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 12px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .logo-container svg {
            width: 100%;
            height: 100%;
        }
        
        .brand-content h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .brand-content p {
            font-size: 15px;
            opacity: 0.9;
            line-height: 1.7;
            max-width: 280px;
        }
        
        /* Features list */
        .features {
            margin-top: 35px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
            opacity: 0.95;
        }
        
        .feature-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .feature-text {
            font-size: 14px;
            font-weight: 400;
        }
        
        /* =====================================================
           RIGHT PANEL - LOGIN FORM
           ===================================================== */
        .login-panel {
            flex: 1;
            padding: 50px 45px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .login-header {
            margin-bottom: 35px;
        }
        
        .login-header h2 {
            font-size: 28px;
            color: #333;
            margin-bottom: 8px;
        }
        
        .login-header p {
            color: #888;
            font-size: 14px;
        }
        
        /* Alert message */
        .alert {
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .alert.show {
            display: flex;
        }
        
        .alert.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        
        .alert.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }
        
        /* Form styles */
        .form-group {
            margin-bottom: 22px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .input-wrapper input {
            width: 100%;
            padding: 15px 18px;
            padding-left: 50px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-family: 'Kanit', sans-serif;
            font-size: 15px;
            transition: all 0.3s;
            outline: none;
        }
        
        .input-wrapper input:focus {
            border-color: #4caf50;
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.1);
        }
        
        .input-wrapper .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: #999;
        }
        
        .input-wrapper .toggle-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #999;
            padding: 5px;
        }
        
        .input-wrapper .toggle-password:hover {
            color: #4caf50;
        }
        
        /* Forgot password link */
        .forgot-link {
            text-align: right;
            margin-bottom: 25px;
        }
        
        .forgot-link a {
            color: #4caf50;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }
        
        .forgot-link a:hover {
            text-decoration: underline;
        }
        
        /* Login button */
        .btn-login {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Kanit', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-login:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
        }
        
        .btn-login:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .btn-login .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }
        
        .btn-login.loading .spinner {
            display: block;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Register link */
        .register-link {
            text-align: center;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid #eee;
            color: #888;
            font-size: 14px;
        }
        
        .register-link a {
            color: #4caf50;
            text-decoration: none;
            font-weight: 600;
        }
        
        .register-link a:hover {
            text-decoration: underline;
        }
        
        /* =====================================================
           RESPONSIVE - MOBILE
           ===================================================== */
        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
                max-width: 450px;
            }
            
            .brand-panel {
                padding: 35px 30px;
            }
            
            .brand-content h1 {
                font-size: 26px;
            }
            
            .features {
                display: none;
            }
            
            .login-panel {
                padding: 35px 30px;
            }
        }
        
        /* =====================================================
           SVG LOGO INLINE STYLES
           ===================================================== */
        .logo-svg .st1 {
            fill: url(#login-gradient);
            fill-rule: evenodd;
        }
        
        .logo-svg .st0 {
            fill: url(#login-gradient1);
            fill-rule: evenodd;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <!-- =====================================================
             LEFT PANEL - BRANDING
             ===================================================== -->
        <div class="brand-panel">
            <div class="brand-content">
                <!-- Logo -->
                <div class="logo-container">
                    <svg class="logo-svg" viewBox="0 0 113.39 113.39" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="login-gradient" x1="4.3" y1="46.15" x2="109.09" y2="46.15" gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#4caf50"/>
                                <stop offset="1" stop-color="#2e7d32"/>
                            </linearGradient>
                            <linearGradient id="login-gradient1" x1="28.17" y1="81.92" x2="90.14" y2="81.92" gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#8d6e63"/>
                                <stop offset="1" stop-color="#5d4037"/>
                            </linearGradient>
                        </defs>
                        <path class="st1" d="M108.66,55.29c-1.3-1.68-5.05,1.69-5.79-1.16-.31-3.19,3.32-6.6,0-10.42-2.71-1.44-4.82-.39-7.53-1.16-.42-2.28-.83-4.6-2-6.06-2.1-.75-5.49,1.12-6.1-1.47.56-2.25,4.27-1.24,3.67-4.02-3.26-3.06-5.67-3.78-7.75-10.3-.38-1.18-1.05-2.59-2.28-2.75-3.42-.45-4.6-3.42-7.68-6.91-3.63-1.29-4.75.72-7.35.94-1.82-.5-1.92-3.48-4.1-3.6-3.1-.59-2.88,2.14-5.8,1.74-4.34-3.28-8.35-.65-11,2.32-8.11-1.99-13.19,3.8-11,12.16-2.06-.06-2.11-2.14-4.63-1.74-3.69,1.91-2.42,8.77-5.79,11-2.75-.24-4.74.28-6.37,1.16-1.51,2.54-1.9,6.21-1.74,10.42-5.13,1.05-7.84,4.52-11,7.53-.76,5.01,2.63,5.9,3.47,9.27-1.59,1.55-2.03,3.76-1.74,6.95,3.03,1.6,3.41,5.85,5.79,8.11,2.5.38,2.89-1.21,4.63-1.73.96.76.48,1.73,1.74,4.05,4.32-.24,2.44,2.21,4.63,3.47,7.33,4.23,6.54-7.56,10.43-9.85,1.69-.15,1.78,1.31,3.47,1.16,1.4-.73,1.33-2.92,3.48-2.9-.76-.2-1.53-.39-2.32-.58.3-2.67,4.26-.39,5.79-.58-.34-2.56-1.29-4.5-2.9-5.79.97-.07,1.76.29,2.47.89-1.71-1.98-3.84-3.53-7.1-3.21-.09-1.44.3-2.4,1.16-2.9,5.47-1.9,8.51,2.56,10.44,6.37.04-2.6-.31-3.18-.01-5.79.62.11,1.15.31,1.63.56-1-.89-2.09-1.69-3.37-2.3-.42-1.58,1.15-1.17,1.16-2.32,3.72.91,4.68,4.58,8.11,5.79,3.82-.71,5.65-6.2,10.43-4.05-.1.48-.29.86-.56,1.17.62.12.29.57-.02.57-.47,2.2,2.73.74,4.05,1.16-.31.21-.64.41-.97.62,2.37-.79,4.66-.11,5.03,3.44-.07,0-.13,0-.19,0,.25-.01.5-.02.77,0,1.68,1.67-1.57,1.37-1.73,2.9.45,2.06,3.93,1.09,4.05,3.47-1.04-.11-2.15-.27-3.25-.38,3.57,3.04,6.97,6.26,11.36,8.49,2.8-2.01,6.86-2.79,12.16-2.32,2.15.36,2.16,2.85,5.21,2.32,4.39-2.98,9.28-11.29,5.21-17.37.44-2.45,3.22-3.68,1.74-6.37ZM10.2,68.04c.65-3.99,5.21-4.06,5.79-8.11.97-.41,1.53-.17,2.32,0,1.19,2.46,1.12,6.05,1.16,8.68-2.45-.27-7.38,3.03-9.27-.58ZM29.31,43.13c-.8-1.8-1.95-1.72-1.74-3.48.98-8.25,13.33,2.83,1.74,3.48ZM43.21,23.44c-.82-.41-1.13-2.13-.58-3.47,4.03,0,6.83-5.53,9.27-1.16-1.16,3.27-5.9,2.9-8.69,4.63ZM66.96,23.44c-1.65,1.01-5.05,1.9-6.37,0-.6-4.45,6.56-3.24,6.37,0ZM60.01,41.4c0-1.36-1-1.7-.58-3.48,2.74-.53,5.24-1.33,8.11-1.74.78,4.93-3.56,6.85-7.53,5.21ZM82.02,46.03c.46-8.2,13.21-1.3,10.42,4.05-4.13-.7-6.42-3.24-10.42-4.05ZM93.6,70.93c-3.49-1.1-5.87-11.05,1.16-9.85,1.44,2.71,3.1,9.12-1.16,9.85Z"/>
                        <path class="st0" d="M28.17,103.93c3.95-5.72,10.51-1.4,15.64-2.9,2.26-.66,5.16-4.07,5.79-6.95.91-4.1,1.14-12.4,0-16.22-1.3-4.36-6.19-5.65-11.58-6.95.3-2.67,4.26-.39,5.79-.58-.34-2.56-1.29-4.5-2.9-5.79,4.38-.32,5.11,8.02,10.42,8.69,3.71-3.04-1.64-5.74-3.47-6.95.1-3.11-.32-3.58,0-6.37,4.25.76,4.7,5.34,8.11,6.95,3.94-1.85,4.61-6.97,9.27-8.11.65.11.32.58,0,.58-.47,2.2,2.73.74,4.05,1.16-2.89,1.93-6.54,3.11-6.94,7.53.1.47.58.58.58,1.16,5.22,0,5.54-4.88,11-4.63,1.68,1.67-1.57,1.37-1.73,2.9.45,2.06,3.93,1.09,4.05,3.47-3.57-.37-7.93-1.4-9.85,1.16-.98,14.36-1.68,27.76,10.42,30.12,4.26.83,10.16-1.49,13.32,2.89H29.9s-1.34,0-1.73-1.16Z"/>
                    </svg>
                </div>
                
                <h1>EABaseHub</h1>
                <p>ระบบจัดการทีมขายครบวงจร<br>บันทึกการเยี่ยมลูกค้า ติดตามงาน<br>และวิเคราะห์ผลการดำเนินงาน</p>
                
                <!-- Features -->
                <div class="features">
                    <div class="feature-item">
                        <div class="feature-icon">     
                        <span class="material-icons">dashboard</span>
                    </div>
                    <span class="feature-text">Dashboard แสดงผลแบบ Real-time</span>
                    </div>                    
                    <div class="feature-item">
                        <div class="feature-icon">
                            <span class="material-icons">assignment_add</span>
                        </div>
                        <span class="feature-text">บันทึกรายงานการเยี่ยมลูกค้า</span>
                    </div>               
                    <div class="feature-item">
                        <div class="feature-icon">
                            <span class="material-icons">data_thresholding</span>
                        </div>
                        <span class="feature-text">วิเคราะห์ยอดขายและแนวโน้ม</span>                        
                    </div>
                    
                </div>
            </div>
        </div>
        
        <!-- =====================================================
             RIGHT PANEL - LOGIN FORM
             ===================================================== -->
        <div class="login-panel">
            <div class="login-header">
                <h2>เข้าสู่ระบบ</h2>
                <p>กรุณากรอกข้อมูลเพื่อเข้าใช้งาน</p>
            </div>
            
            <!-- Alert -->
            <div class="alert" id="alert">
                <span id="alertIcon">❌</span>
                <span id="alertMessage"></span>
            </div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <!-- Username -->
                <div class="form-group">
                    <label>ชื่อผู้ใช้ (Username)</label>
                    <div class="input-wrapper">
                        <span class="input-icon"><i class="material-icons">person</i></span>
                        <input type="text" id="username" placeholder="กรอกชื่อผู้ใช้" required autocomplete="username">
                    </div>
                </div>
                
                <!-- Password -->
                <div class="form-group">
                    <label>รหัสผ่าน</label>
                    <div class="input-wrapper">
                        <span class="input-icon"><i class="material-icons">lock_person</i></span>
                        <input type="password" id="password" placeholder="กรอกรหัสผ่าน" required autocomplete="current-password">
                        <button type="button" class="toggle-password" onclick="togglePassword()"><i class="material-icons">visibility</i></button>
                    </div>
                </div>
                
                <!-- Forgot Password -->
                <div class="forgot-link">
                    <a href="<?= ScriptApp.getService().getUrl() ?>?page=reset-password">ลืมรหัสผ่าน?</a>
                </div>
                
                <!-- Login Button -->
                <button type="submit" class="btn-login" id="loginBtn">
                    <span class="spinner"></span>
                    <span class="btn-text">เข้าสู่ระบบ</span>
                </button>
            </form>
            
            <!-- Register Link -->
            <div class="register-link">
                ยังไม่มีบัญชี? <a href="<?= ScriptApp.getService().getUrl() ?>?page=register">สมัครสมาชิก</a>
            </div>
        </div>
    </div>

    <script>
        // =====================================================
        // LOGIN HANDLER
        // =====================================================
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showAlert('error', '❌', 'กรุณากรอกชื่อผู้ใช้และรหัสผ่าน');
                return;
            }
            
            const btn = document.getElementById('loginBtn');
            btn.classList.add('loading');
            btn.disabled = true;
            
            google.script.run
                .withSuccessHandler(function(result) {
                    btn.classList.remove('loading');
                    btn.disabled = false;
                    
                    if (result.success) {
                        // Store user data in session
                        sessionStorage.setItem('user', JSON.stringify(result.user));
                        
                        // Redirect based on user type
                        const userType = result.user.type;
                        if (userType === 'admin' || userType === 'manager') {
                            window.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=admin';
                        } else {
                            window.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=dashboard';
                        }
                    } else {
                        showAlert('error', '❌', result.message || 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
                    }
                })
                .withFailureHandler(function(error) {
                    btn.classList.remove('loading');
                    btn.disabled = false;
                    showAlert('error', '❌', 'เกิดข้อผิดพลาดในการเชื่อมต่อ');
                })
                .checkLoginSimple(username, password);
        }
        
        // =====================================================
        // TOGGLE PASSWORD
        // =====================================================
        function togglePassword() {
            const input = document.getElementById('password');
            const btn = document.querySelector('.toggle-password');
            const icon = btn.querySelector('.material-icons');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'visibility_off';
            } else {
                input.type = 'password';
                icon.textContent = 'visibility';
            }
        }
        
        // =====================================================
        // ALERT HELPER
        // =====================================================
        function showAlert(type, icon, message) {
            const alert = document.getElementById('alert');
            const alertIcon = document.getElementById('alertIcon');
            const alertMessage = document.getElementById('alertMessage');
            
            alert.className = 'alert ' + type + ' show';
            alertIcon.textContent = icon;
            alertMessage.textContent = message;
            
            setTimeout(function() {
                alert.classList.remove('show');
            }, 5000);
        }
        
        // =====================================================
        // CHECK IF ALREADY LOGGED IN
        // =====================================================
        document.addEventListener('DOMContentLoaded', function() {
            const userData = sessionStorage.getItem('user');
            if (userData) {
                const user = JSON.parse(userData);
                // Redirect based on user type
                if (user.type === 'admin' || user.type === 'manager') {
                    window.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=admin';
                } else {
                    window.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=dashboard';
                }
                return;
            }
            
            // Focus username input
            document.getElementById('username').focus();
        });
    </script>
</body>
</html>
