<!DOCTYPE html>
<html lang="th">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EABaseHub Dashboard</title>
    <!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- iOS -->
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="EA Base Hub">

<!-- Theme -->
<meta name="theme-color" content="#ffffff">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            font-family: 'Kanit', sans-serif;
            background: #e8f5e9;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* =====================================================
           MAIN LAYOUT - 4 COLUMNS (Optimized for Tablet Landscape)
           ===================================================== */
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 260px;
            grid-template-rows: auto auto 1fr;
            min-height: 100vh;
            padding: 12px;
            gap: 12px;
        }
        
        /* =====================================================
           TOP HEADER
           ===================================================== */
        .top-header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }


        /* =======================
   LOGO (Top Header)
   ======================= */
.logo {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
.logo-container {
    width: 44px;
    height: 44px;
    padding: 4px;
    background: white;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

/* SVG */
.logo-svg {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

/* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
.logo-text {
    font-size: 18px;
    font-weight: 700;
    color: #2e7d32;
    white-space: nowrap;
}



        
        
        .nav-tabs {
            display: flex;
            gap: 6px;
        }
        
        .nav-tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            font-size: 13px;
            font-weight: 500;
            background: #f5f5f5;
            border: none;
            font-family: 'Kanit', sans-serif;
        }
        
        .nav-tab:hover { background: #e8f5e9; color: #2e7d32; }
        .nav-tab.active { background: #4caf50; color: white; }
        .nav-tab.admin-tab { background: #fff3e0; color: #e65100; }
        .nav-tab.admin-tab:hover { background: #ffe0b2; }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .period-select {
            padding: 6px 12px;
            border: 2px solid #c8e6c9;
            border-radius: 8px;
            background: white;
            font-family: 'Kanit', sans-serif;
            font-size: 12px;
            color: #2e7d32;
            cursor: pointer;
            outline: none;
        }
        
        .user-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #4caf50;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            font-family: 'Kanit', sans-serif;
        }
        
        .user-avatar {
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4caf50;
            font-weight: 600;
            font-size: 12px;
        }
        
        /* =====================================================
           GREETING + STATS (Columns 1-3, Row 2)
           ===================================================== */
        .main-top {
            grid-column: 1 / 4;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .greeting-card {
            background: white;
            border-radius: 12px;
            padding: 14px 18px;
        }
        
        .greeting-card h1 {
            font-size: 18px;
            color: #2e7d32;
            font-weight: 600;
        }
        
        .greeting-card p {
            color: #81c784;
            font-size: 12px;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .stat-card {
            background: #e0e0e0;
            border-radius: 12px;
            padding: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .stat-icon.green { background: #e8f5e9; }
        .stat-icon.yellow { background: #fff9c4; }
        .stat-icon.orange { background: #ffe0b2; }
        
        .stat-info h3 {
            font-size: 22px;
            color: #333;
            font-weight: 600;
            line-height: 1;
        }
        
        .stat-info p {
            font-size: 11px;
            color: #888;
        }
        
        .stat-info .coming-soon-text {
            color: #ff9800;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* =====================================================
           PROFILE CARD (Column 4, Row 2)
           ===================================================== */
        .profile-card {
            grid-column: 4;
            grid-row: 2;
            background: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            background: #e8f5e9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 24px;
            color: #4caf50;
            border: 2px solid #4caf50;
        }
        
        .profile-card h3 {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .profile-card .email {
            font-size: 11px;
            color: #888;
            margin-bottom: 8px;
            word-break: break-all;
        }
        
        .zone-badge {
            display: inline-block;
            background: #e8f5e9;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 10px;
        }
        
        /* =====================================================
           MAIN CONTENT (Columns 1-3, Row 3)
           ===================================================== */
        .main-content {
            grid-column: 1 / 4;
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow: hidden;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .action-card {
            border-radius: 12px;
            padding: 60px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .action-card.green {
            background: linear-gradient(135deg, #81c784, #66bb6a);
            color: white;
        }
        
        .action-card.yellow {
            background: linear-gradient(135deg, #fff176, #ffee58);
            color: #5d4037;
        }
        
        .action-card.orange {
            background: linear-gradient(135deg, #ffab91, #ff8a65);
            color: white;
        }
        
        .action-card .action-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .action-card h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .action-card p {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 6px;
        }
        
        .action-card .coming-soon-badge {
            display: inline-block;
            background: rgba(255,255,255,0.9);
            color: #795548;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 10px;
        }
        
        .progress-section {
            background: white;
            border-radius: 12px;
            padding: 14px 18px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .progress-header h4 {
            font-size: 13px;
            color: #333;
        }
        
        .progress-header span {
            font-size: 16px;
            font-weight: 600;
            color: #4caf50;
        }
        
        .progress-bar {
            height: 10px;
            background: #e8f5e9;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #66bb6a, #4caf50);
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .reports-section {
            background: white;
            border-radius: 12px;
            padding: 14px 18px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
        }
        
        .reports-section h4 {
            font-size: 13px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .report-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .report-item:last-child { border-bottom: none; }
        
        .report-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }
        
        .report-icon { font-size: 16px; }
        
        .report-text {
            font-size: 12px;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .report-actions {
            display: flex;
            gap: 6px;
        }
        
        .report-actions button {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-edit { background: #e8f5e9; color: #4caf50; }
        .btn-delete { background: #ffebee; color: #e53935; }
        
        .empty-state {
            text-align: center;
            padding: 20px;
            color: #999;
        }
        
        .empty-state .icon { font-size: 32px; margin-bottom: 6px; }
        .empty-state p { font-size: 12px; }
        
        /* =====================================================
           RIGHT SIDEBAR (Column 4, Row 3)
           ===================================================== */
        .right-sidebar {
            grid-column: 4;
            grid-row: 3;
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow: hidden;
        }
        
        .calendar-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-shrink: 0;
        }
        
        .calendar-header h4 {
            font-size: 13px;
            color: #333;
            font-weight: 600;
        }
        
        .calendar-nav {
            display: flex;
            gap: 4px;
        }
        
        .calendar-nav button {
            width: 24px;
            height: 24px;
            border: 1px solid #e0e0e0;
            background: white;
            color: #4caf50;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            text-align: center;
            flex: 1;
            align-content: start;
        }
        
        .calendar-day-header {
            font-size: 10px;
            color: #999;
            padding: 4px 0;
            font-weight: 500;
        }
        
        .calendar-day {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            border-radius: 6px;
            cursor: pointer;
            color: #333;
            margin: 0 auto;
        }
        
        .calendar-day:hover { background: #e8f5e9; }
        .calendar-day.today { background: #4caf50; color: white; font-weight: 600; }
        .calendar-day.has-report { background: #c8e6c9; color: #2e7d32; font-weight: 500; }
        .calendar-day.other-month { color: #ccc; }
        
        .forms-hub-btn {
            background: linear-gradient(135deg, #fff9c4, #fff176);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            width: 100%;
            font-family: 'Kanit', sans-serif;
            flex-shrink: 0;
        }
        
        .forms-hub-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .forms-hub-btn .icon { font-size: 28px; margin-bottom: 6px; }
        .forms-hub-btn h4 { font-size: 13px; color: #5d4037; margin-bottom: 2px; }
        .forms-hub-btn p { font-size: 10px; color: #8d6e63; }
        .forms-hub-btn .badge {
            display: inline-block;
            background: white;
            color: #ff9800;
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 9px;
            margin-top: 6px;
        }
        
        /* =====================================================
           MODAL
           ===================================================== */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }
        
        .modal-overlay.show { display: flex; }
        
        .modal {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 480px;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 14px 18px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            border-radius: 16px 16px 0 0;
        }
        
        .modal-header h3 { font-size: 15px; color: #333; }
        
        .modal-close {
            width: 30px;
            height: 30px;
            border: none;
            background: #f5f5f5;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            color: #666;
        }
        
        .modal-body { padding: 18px; }
        
        .form-group { margin-bottom: 12px; }
        
        .form-group label {
            display: block;
            font-size: 12px;
            color: #333;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Kanit', sans-serif;
            font-size: 13px;
            outline: none;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #4caf50;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }
        
        .btn-cancel, .btn-submit {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            font-family: 'Kanit', sans-serif;
            font-size: 13px;
            cursor: pointer;
        }
        
        .btn-cancel {
            background: white;
            border: 2px solid #e0e0e0;
            color: #666;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #66bb6a, #4caf50);
            border: none;
            color: white;
        }
        
        /* Loading & Toast */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
        }
        
        .loading-overlay.show { display: flex; }
        
        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid #e8f5e9;
            border-top-color: #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 12px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 3000;
        }
        
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: #4caf50; }
        .toast.error { background: #e53935; }
        
        /* =====================================================
           RESPONSIVE - Tablet Portrait
           ===================================================== */
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr 1fr 220px;
                padding: 10px;
                gap: 10px;
            }
            
            .main-top { grid-column: 1 / 3; }
            .profile-card { grid-column: 3; }
            .main-content { grid-column: 1 / 3; }
            .right-sidebar { grid-column: 3; }
            
            .nav-tab span { display: none; }
            .nav-tab { padding: 8px 12px; }
        }
        
        /* =====================================================
           RESPONSIVE - Mobile
           ===================================================== */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            .logo-text {
                font-size: 16px;
            }

            .logo-container {
                width: 38px;
                height: 38px;
             }
            
            .main-top { grid-column: 1; }
            .profile-card { display: none; }
            .main-content { grid-column: 1; }
            .right-sidebar { 
                grid-column: 1; 
                flex-direction: row;
                gap: 10px;
            }
            
            .calendar-card { flex: 2; }
            .forms-hub-btn { flex: 1; }
            
            .stats-row { grid-template-columns: repeat(3, 1fr); }
            .action-buttons { grid-template-columns: repeat(3, 1fr); }
            
            .top-header { flex-wrap: wrap; gap: 8px; padding: 10px 12px; }
            .nav-tabs { width: 100%; justify-content: center; order: 3; }
            .nav-tab span { display: none; }
        }
        
        /* Forms Menu Modal Styles */
        .forms-menu-modal {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .forms-menu-header {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .forms-menu-header h3 {
            color: white;
            font-size: 20px;
            margin: 0;
        }
        
        .modal-close-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .modal-close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .forms-menu-content {
            padding: 25px;
        }
        
        .forms-menu-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .forms-menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .form-menu-card {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .form-menu-card:hover {
            background: #e8f5e9;
            border-color: #4caf50;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76,175,80,0.2);
        }
        
        .form-menu-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            position: relative;
        }
        
        .form-menu-card.disabled:hover {
            background: #f8f9fa;
            border-color: transparent;
            transform: none;
            box-shadow: none;
        }
        
        .form-menu-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
        }
        
        .form-menu-icon i {
            font-size: 28px;
            color: white;
        }
        
        .form-menu-icon.blue { background: linear-gradient(135deg, #2196f3, #1565c0); }
        .form-menu-icon.green { background: linear-gradient(135deg, #4caf50, #2e7d32); }
        .form-menu-icon.orange { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .form-menu-icon.gray { background: linear-gradient(135deg, #9e9e9e, #757575); }
        
        .form-menu-card h4 {
            font-size: 14px;
            color: #333;
            margin: 0 0 5px;
            font-weight: 600;
        }
        
            color: #888;
            margin: 0;
        }
        
        .coming-soon-tag {
            display: inline-block;
            background: #ffeb3b;
            color: #333;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            margin-top: 8px;
            font-weight: 600;
        }
        
        @media (max-width: 400px) {
            .forms-menu-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- TOP HEADER -->
        <header class="top-header">
            <!-- Logo with FIXED SVG Colors -->
            <div class="logo">
                <div class="logo-container">
                    <svg class="logo-svg" viewBox="0 0 113.39 113.39" xmlns="http://www.w3.org/2000/svg" aria-label="EABaseHub Logo">
                        <defs>
                            <style>
                                .st0 {
                                    fill: url(#linear-gradient1);
                                    fill-rule: evenodd;
                                }
                                .st1 {
                                    fill: url(#linear-gradient);
                                    fill-rule: evenodd;
                                }
                            </style>
                            <linearGradient id="linear-gradient" x1="4.3" y1="46.15" x2="109.09" y2="46.15" gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#4caf50"/>
                                <stop offset="1" stop-color="#2e7d32"/>
                            </linearGradient>
                            <linearGradient id="linear-gradient1" x1="28.17" y1="81.92" x2="90.14" y2="81.92" gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#8d6e63"/>
                                <stop offset="1" stop-color="#5d4037"/>
                            </linearGradient>
                        </defs>
                        <path class="st1" d="M108.66,55.29c-1.3-1.68-5.05,1.69-5.79-1.16-.31-3.19,3.32-6.6,0-10.42-2.71-1.44-4.82-.39-7.53-1.16-.42-2.28-.83-4.6-2-6.06-2.1-.75-5.49,1.12-6.1-1.47.56-2.25,4.27-1.24,3.67-4.02-3.26-3.06-5.67-3.78-7.75-10.3-.38-1.18-1.05-2.59-2.28-2.75-3.42-.45-4.6-3.42-7.68-6.91-3.63-1.29-4.75.72-7.35.94-1.82-.5-1.92-3.48-4.1-3.6-3.1-.59-2.88,2.14-5.8,1.74-4.34-3.28-8.35-.65-11,2.32-8.11-1.99-13.19,3.8-11,12.16-2.06-.06-2.11-2.14-4.63-1.74-3.69,1.91-2.42,8.77-5.79,11-2.75-.24-4.74.28-6.37,1.16-1.51,2.54-1.9,6.21-1.74,10.42-5.13,1.05-7.84,4.52-11,7.53-.76,5.01,2.63,5.9,3.47,9.27-1.59,1.55-2.03,3.76-1.74,6.95,3.03,1.6,3.41,5.85,5.79,8.11,2.5.38,2.89-1.21,4.63-1.73.96.76.48,1.73,1.74,4.05,4.32-.24,2.44,2.21,4.63,3.47,7.33,4.23,6.54-7.56,10.43-9.85,1.69-.15,1.78,1.31,3.47,1.16,1.4-.73,1.33-2.92,3.48-2.9-.76-.2-1.53-.39-2.32-.58.3-2.67,4.26-.39,5.79-.58-.34-2.56-1.29-4.5-2.9-5.79.97-.07,1.76.29,2.47.89-1.71-1.98-3.84-3.53-7.1-3.21-.09-1.44.3-2.4,1.16-2.9,5.47-1.9,8.51,2.56,10.44,6.37.04-2.6-.31-3.18-.01-5.79.62.11,1.15.31,1.63.56-1-.89-2.09-1.69-3.37-2.3-.42-1.58,1.15-1.17,1.16-2.32,3.72.91,4.68,4.58,8.11,5.79,3.82-.71,5.65-6.2,10.43-4.05-.1.48-.29.86-.56,1.17.62.12.29.57-.02.57-.47,2.2,2.73.74,4.05,1.16-.31.21-.64.41-.97.62,2.37-.79,4.66-.11,5.03,3.44-.07,0-.13,0-.19,0,.25-.01.5-.02.77,0,1.68,1.67-1.57,1.37-1.73,2.9.45,2.06,3.93,1.09,4.05,3.47-1.04-.11-2.15-.27-3.25-.38,3.57,3.04,6.97,6.26,11.36,8.49,2.8-2.01,6.86-2.79,12.16-2.32,2.15.36,2.16,2.85,5.21,2.32,4.39-2.98,9.28-11.29,5.21-17.37.44-2.45,3.22-3.68,1.74-6.37ZM10.2,68.04c.65-3.99,5.21-4.06,5.79-8.11.97-.41,1.53-.17,2.32,0,1.19,2.46,1.12,6.05,1.16,8.68-2.45-.27-7.38,3.03-9.27-.58ZM29.31,43.13c-.8-1.8-1.95-1.72-1.74-3.48.98-8.25,13.33,2.83,1.74,3.48ZM43.21,23.44c-.82-.41-1.13-2.13-.58-3.47,4.03,0,6.83-5.53,9.27-1.16-1.16,3.27-5.9,2.9-8.69,4.63ZM66.96,23.44c-1.65,1.01-5.05,1.9-6.37,0-.6-4.45,6.56-3.24,6.37,0ZM60.01,41.4c0-1.36-1-1.7-.58-3.48,2.74-.53,5.24-1.33,8.11-1.74.78,4.93-3.56,6.85-7.53,5.21ZM82.02,46.03c.46-8.2,13.21-1.3,10.42,4.05-4.13-.7-6.42-3.24-10.42-4.05ZM93.6,70.93c-3.49-1.1-5.87-11.05,1.16-9.85,1.44,2.71,3.1,9.12-1.16,9.85Z"/>
                        <path class="st0" d="M28.17,103.93c3.95-5.72,10.51-1.4,15.64-2.9,2.26-.66,5.16-4.07,5.79-6.95.91-4.1,1.14-12.4,0-16.22-1.3-4.36-6.19-5.65-11.58-6.95.3-2.67,4.26-.39,5.79-.58-.34-2.56-1.29-4.5-2.9-5.79,4.38-.32,5.11,8.02,10.42,8.69,3.71-3.04-1.64-5.74-3.47-6.95.1-3.11-.32-3.58,0-6.37,4.25.76,4.7,5.34,8.11,6.95,3.94-1.85,4.61-6.97,9.27-8.11.65.11.32.58,0,.58-.47,2.2,2.73.74,4.05,1.16-2.89,1.93-6.54,3.11-6.94,7.53.1.47.58.58.58,1.16,5.22,0,5.54-4.88,11-4.63,1.68,1.67-1.57,1.37-1.73,2.9.45,2.06,3.93,1.09,4.05,3.47-3.57-.37-7.93-1.4-9.85,1.16-.98,14.36-1.68,27.76,10.42,30.12,4.26.83,10.16-1.49,13.32,2.89H29.9s-1.34,0-1.73-1.16Z"/>
                    </svg>
                </div>
                <span class="logo-text">EABaseHub</span>
            </div>
            
            <nav class="nav-tabs">
                <button class="nav-tab active" type="button">
                    <span class="material-icon nav-icon">home</span>
                <span>HOME</span>
                </button>

                <button class="nav-tab" type="button"  onclick="openAddReportModal()">
                    <span class="material-icons nav-icon">note_add</span>
                    <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
                </button>
                <button class="nav-tab" type="button"  onclick="goToPage('shops')">
                    <span class="material-icons nav-icon">store</span>
                    <span>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                </button>

                <button class="nav-tab admin-tab" id="adminTab" style="display:none;"
                 type="button"  onclick="goToPage('admin')">
                 <span class="material-icons nav-icon">settings</span>
                 <span>Admin</span>
                </button>

            </nav>
            
            <div class="header-right">
                <select class="period-select" id="periodSelect" onchange="changePeriod()">
                    <option value="month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</option>
                    <option value="week">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</option>
                    <option value="year">‡∏õ‡∏µ‡∏ô‡∏µ‡πâ</option>
                </select>
                <button class="user-btn" onclick="toggleUserMenu()">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <span id="userEmail">Loading...</span>
                </button>
            </div>
        </header>
        
        <!-- GREETING + STATS -->
        <div class="main-top">
            <div class="greeting-card">
                <h1>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ : <span id="userName">Loading...</span></h1>
                <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
            </div>
            
            <div class="stats-row">
                <div class="stat-card" onclick="goToPage('shops')">
                    <div class="stat-icon green"><i class="material-icons">store</i></div>
                    <div class="stat-info">
                        <h3 id="totalShops">0</h3>
                        <p>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</p>
                    </div>
                </div>
                <div class="stat-card" onclick="showComingSoon('‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô')">
                    <div class="stat-icon yellow"><i class="material-icons">trophy</i></div>
                    <div class="stat-info">
                        <!-- <span class="coming-soon-text">Coming Soon</span> -->
                        <p>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</p>
                    </div>
                </div>
                <div class="stat-card" onclick="showComingSoon('Comming Soon')">
                    <div class="stat-icon orange"><i class="material-icons">terminal</i></div>
                    <div class="stat-info">
                        <!-- <span class="coming-soon-text">Coming Soon</span> -->
                        <p>Comming Soon</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PROFILE CARD -->
        <div class="profile-card">
            <div class="profile-avatar" id="profileAvatar"><i class="material-icons">person</i></div>
            <h3 id="profileName">Loading...</h3>
            <p class="email" id="profileEmail">Loading...</p>
            <div class="zone-badge" id="zoneBadge"><i class="material-icons">hourglass_bottom</i>Loading...</div>
        </div>
        
        <!-- MAIN CONTENT -->
        <main class="main-content">
            <div class="action-buttons">
                <div class="action-card green" onclick="openAddReportModal()">
                    <i class="material-icons">edit_document</i>
                    <h3>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                    <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                </div>
                <div class="action-card yellow" onclick="openFormsMenuModel('Forms menu')">
                    <i class="material-icons">assignment_add</i>
                    <h3>Forms Hub</h3>
                    <p>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</p>
                </div>
                <div class="action-card orange" onclick="showComingSoon('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ñ‡∏•‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤')">
                    <i class="material-icons">report</i>
                    <h3>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ñ‡∏•‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <p>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ñ‡∏•‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤</p>
                    <!-- <span class="coming-soon-badge">Coming Soon</span> -->
                </div>
            </div>
            
            <div class="progress-section">
                <div class="progress-header">
                    <i class="material-icons">assignment_add</i>
                    <h4>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</h4>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="reports-section">
                <h4>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h4>
                <div id="recentReports">
                    <div class="empty-state">
                        <div class="icon"><i class="material-icons">assignment</i></div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- RIGHT SIDEBAR -->
        <aside class="right-sidebar">
            <div class="calendar-card">
                <div class="calendar-header">
                    <h4 id="calendarMonth">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2569</h4>
                    <div class="calendar-nav">
                        <button onclick="prevMonth()">‚Äπ</button>
                        <button onclick="nextMonth()">‚Ä∫</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            
            <button class="forms-hub-btn" onclick="showComingSoon('Forms Hub')">
                <div class="icon">üìã</div>
                <h4>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</h4>
                <p>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p>
                <span class="badge">Coming Soon</span>
            </button>
        </aside>
    </div>
    
    <!-- MODAL -->
    <div class="modal-overlay" id="reportModal">
        <div class="modal">
            <div class="modal-header"><i class="material-icons">stylus_note</i>
                <h3>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                <button class="modal-close" onclick="closeAddReportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="reportForm" onsubmit="submitReport(event)">
                    <div class="form-group">
                        <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span style="color:red">*</span></label>
                        <input type="date" id="reportDate" required>
                    </div>
                    <div class="form-group">
                        <label>üè™ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ <span style="color:red">*</span></label>
                        <select id="reportShop" required>
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üìÅ ‡∏´‡∏°‡∏ß‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span style="color:red">*</span></label>
                            <select id="reportCategory" required onchange="onCategoryChange()">
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span style="color:red">*</span></label>
                            <select id="reportProduct" required disabled>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏Å‡πà‡∏≠‡∏ô --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üì± ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤</label>
                            <select id="reportSource">
                                <option value="Walk-in">Walk-in</option>
                                <option value="LINE">LINE</option>
                                <option value="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                            <select id="reportStatus">
                                <option value="‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß">‚úÖ ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå">üõí ‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</option>
                                <option value="‡∏£‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°">‚è≥ ‡∏£‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üí∞ ‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="reportAmount" placeholder="0" min="0">
                        </div>
                        <div class="form-group">
                            <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</label>
                            <input type="date" id="reportFollowUp">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="reportNote" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" onclick="closeAddReportModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="btn-submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- FORMS MENU MODAL -->
    <div class="modal-overlay" id="formsMenuModal" onclick="if(event.target === this) closeFormsMenuModal()">
        <div class="forms-menu-modal">
            <div class="forms-menu-header">
                <h3>üìã Forms Hub</h3>
                <button class="modal-close-btn" onclick="closeFormsMenuModal()">&times;</button>
            </div>
            <div class="forms-menu-content">
                <p class="forms-menu-subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
                
                <div class="forms-menu-grid">
                    <div class="form-menu-card" onclick="navigateToForm('form1')">
                        <div class="form-menu-icon blue">
                            <i class="material-icons">assignment</i>
                        </div>
                        <h4>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</h4>
                        <p>‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ ‡πë</p>
                    </div>
                    
                    <div class="form-menu-card" onclick="navigateToForm('form2')">
                        <div class="form-menu-icon green">
                            <i class="material-icons">receipt_long</i>
                        </div>
                        <h4>‡πÉ‡∏ö‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á</h4>
                        <p>‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡πí</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p style="margin-top: 10px; color: #4caf50; font-size: 12px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
        let currentUser = null;
        let myShops = [];
        let allCategories = [];
        let allProducts = [];
        let reportDates = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        
        document.addEventListener('DOMContentLoaded', function() {
            const userData = sessionStorage.getItem('user');
            if (!userData) {
                window.top.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=login';
                return;
            }
            currentUser = JSON.parse(userData);
            
            if (currentUser.type === 'admin' || currentUser.type === 'manager') {
                document.getElementById('adminTab').style.display = 'flex';
            }
            
            if (!currentUser.type) currentUser.type = 'sales';
            
            console.log('Current user:', currentUser);
            
            google.script.run.withSuccessHandler(function(ver) {
                console.log('App Version:', ver);
            }).getAppVersion();
            
            updateUserUI();
            loadDashboardData();
            loadDropdownData();
            generateCalendar();
            document.getElementById('reportDate').value = formatDateForInput(new Date());
        });
        
        function goToPage(page) {
            google.script.run.withSuccessHandler(function(url) {
                window.top.location.href = url + '?page=' + page;
            }).getBaseUrl();
        }
        
        function updateUserUI() {
            const name = currentUser.displayName || currentUser.name;
            document.getElementById('userName').textContent = name;
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileEmail').textContent = currentUser.email || '';
            document.getElementById('userEmail').textContent = currentUser.email || name;
            const initial = name.charAt(0).toUpperCase();
            document.getElementById('userAvatar').textContent = initial;
            document.getElementById('profileAvatar').textContent = initial;
        }
        
        function loadDashboardData() {
            showLoading(true);
            const period = document.getElementById('periodSelect').value;
            let userId = currentUser.id || currentUser.username || currentUser.name || '';
            
            console.log('Loading dashboard data for userId:', userId, 'type:', currentUser.type, 'period:', period);
            
            if (!userId) {
                console.error('No userId found!');
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡πÉ‡∏´‡∏°‡πà', 'error');
                sessionStorage.clear();
                setTimeout(function() {
                    window.top.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=login';
                }, 2000);
                return;
            }
            
            google.script.run
                .withSuccessHandler(function(result) {
                    showLoading(false);
                    console.log('Dashboard data received:', result);
                    if (result && result.success) {
                        updateDashboard(result);
                    } else {
                        console.error('Dashboard error:', result);
                        updateDashboard({ stats: { myShops: 0 }, reportProgress: { writtenDays: 0, passedDays: 1 }, recentReports: [], reportDates: [], myShops: [], userZone: '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î' });
                    }
                })
                .withFailureHandler(function(error) {
                    showLoading(false);
                    console.error('Server error:', error);
                    showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                })
                .getSalesDashboardData(userId, currentUser.type, period);
        }
        
        function updateDashboard(data) {
            console.log('Updating dashboard with:', data);
            document.getElementById('totalShops').textContent = data.stats ? (data.stats.myShops || 0) : 0;
            document.getElementById('zoneBadge').textContent = 'üìç ' + (data.userZone || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î');
            
            const progress = data.reportProgress || {};
            const percent = progress.passedDays > 0 ? Math.round((progress.writtenDays / progress.passedDays) * 100) : 0;
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('progressFill').style.width = percent + '%';
            
            renderReports(data.recentReports || []);
            reportDates = data.reportDates || [];
            generateCalendar();
            
            if (data.myShops && data.myShops.length > 0) {
                myShops = data.myShops;
                populateShopDropdown();
            }
        }
        
        function renderReports(reports) {
            const container = document.getElementById('recentReports');
            if (!reports || reports.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üìã</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p></div>';
                return;
            }
            let html = '';
            reports.slice(0, 5).forEach(function(r) {
                const d = new Date(r.date);
                html += '<div class="report-item"><div class="report-info"><span class="report-icon">üìã</span><span class="report-text">' + formatDate(d) + ' - ' + (r.shop || '') + '</span></div><div class="report-actions"><button class="btn-edit" onclick="editReport(' + r.rowIndex + ')">‚úèÔ∏è</button><button class="btn-delete" onclick="deleteReport(' + r.rowIndex + ')">üóëÔ∏è</button></div></div>';
            });
            container.innerHTML = html;
        }
        
        function loadDropdownData() {
            const userId = currentUser.id || currentUser.username || currentUser.name || '';
            google.script.run.withSuccessHandler(function(shops) {
                if (shops && shops.length > 0) { myShops = shops; populateShopDropdown(); }
            }).getShopList(userId, currentUser.type);
            
            google.script.run.withSuccessHandler(function(result) {
                if (result && result.success) {
                    allCategories = result.categories || [];
                    allProducts = result.products || [];
                    populateCategoryDropdown();
                }
            }).getCategoriesAndProducts();
        }
        
        function populateShopDropdown() {
            const s = document.getElementById('reportShop');
            s.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>';
            myShops.forEach(function(shop) { s.innerHTML += '<option value="' + (shop.name || shop) + '">' + (shop.name || shop) + '</option>'; });
        }
        
        function populateCategoryDropdown() {
            const s = document.getElementById('reportCategory');
            s.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î --</option>';
            allCategories.forEach(function(c) { s.innerHTML += '<option value="' + c + '">' + c + '</option>'; });
        }
        
        function onCategoryChange() {
            const cat = document.getElementById('reportCategory').value;
            const ps = document.getElementById('reportProduct');
            ps.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>';
            if (!cat) { ps.disabled = true; return; }
            ps.disabled = false;
            allProducts.filter(function(p) { return p.category === cat; }).forEach(function(p) {
                ps.innerHTML += '<option value="' + p.name + '">' + p.name + '</option>';
            });
        }
        
        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            const today = new Date();
            
            const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
            document.getElementById('calendarMonth').textContent = thaiMonths[currentMonth] + ' ' + (currentYear + 543);
            
            let html = '';
            ['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'].forEach(function(d) { html += '<div class="calendar-day-header">' + d + '</div>'; });
            for (let i = 0; i < startDay; i++) html += '<div class="calendar-day other-month"></div>';
            for (let day = 1; day <= totalDays; day++) {
                const isToday = today.getDate() === day && today.getMonth() === currentMonth && today.getFullYear() === currentYear;
                const hasReport = reportDates.includes(day);
                let cls = 'calendar-day';
                if (isToday) cls += ' today';
                else if (hasReport) cls += ' has-report';
                html += '<div class="' + cls + '" onclick="selectDay(' + day + ')">' + day + '</div>';
            }
            grid.innerHTML = html;
        }
        
        function prevMonth() { currentMonth--; if (currentMonth < 0) { currentMonth = 11; currentYear--; } generateCalendar(); }
        function nextMonth() { currentMonth++; if (currentMonth > 11) { currentMonth = 0; currentYear++; } generateCalendar(); }
        function selectDay(day) { document.getElementById('reportDate').value = formatDateForInput(new Date(currentYear, currentMonth, day)); openAddReportModal(); }
        
        function openAddReportModal() {
            document.getElementById('reportForm').reset();
            document.getElementById('reportDate').value = formatDateForInput(new Date());
            document.getElementById('reportProduct').disabled = true;
            document.getElementById('reportProduct').innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏Å‡πà‡∏≠‡∏ô --</option>';
            document.getElementById('reportModal').classList.add('show');
        }
        
        function closeAddReportModal() { document.getElementById('reportModal').classList.remove('show'); }
        
        function submitReport(e) {
            e.preventDefault();
            const cat = document.getElementById('reportCategory').value;
            const prod = document.getElementById('reportProduct').value;
            const data = {
                date: document.getElementById('reportDate').value,
                userId: currentUser.id || currentUser.username || currentUser.name,
                shop: document.getElementById('reportShop').value,
                product: cat + ' - ' + prod,
                amount: parseFloat(document.getElementById('reportAmount').value) || 0,
                source: document.getElementById('reportSource').value,
                status: document.getElementById('reportStatus').value,
                followUpDate: document.getElementById('reportFollowUp').value,
                note: document.getElementById('reportNote').value
            };
            showLoading(true);
            google.script.run.withSuccessHandler(function(r) {
                showLoading(false);
                if (r && r.success) { closeAddReportModal(); showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success'); loadDashboardData(); }
                else showToast(r ? r.message : '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }).withFailureHandler(function() { showLoading(false); showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ', 'error'); }).saveReport(data);
        }
        
        function editReport(idx) { showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'success'); }
        function deleteReport(idx) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?')) return;
            showLoading(true);
            google.script.run.withSuccessHandler(function(r) {
                showLoading(false);
                if (r && r.success) { showToast('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success'); loadDashboardData(); }
                else showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ', 'error');
            }).withFailureHandler(function() { showLoading(false); showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error'); }).deleteReport(idx);
        }
        
        function changePeriod() { loadDashboardData(); }
        function showComingSoon(f) { showToast('üöß ' + f + ' - Coming Soon', 'success'); }
        function toggleUserMenu() { if (confirm('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) { sessionStorage.clear(); window.top.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=login'; } }
        function formatDateForInput(d) { return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'); }
        function formatDate(d) { return String(d.getDate()).padStart(2, '0') + '/' + String(d.getMonth() + 1).padStart(2, '0') + '/' + (d.getFullYear() + 543); }
        function showLoading(s) { document.getElementById('loadingOverlay').classList.toggle('show', s); }
        function showToast(m, t) { const toast = document.getElementById('toast'); toast.textContent = m; toast.className = 'toast show ' + (t || ''); setTimeout(function() { toast.classList.remove('show'); }, 3000); }
        
        function openFormsMenuModel(title) {
            document.getElementById('formsMenuModal').classList.add('show');
        }
        
        function closeFormsMenuModal() {
            document.getElementById('formsMenuModal').classList.remove('show');
        }
        
        function navigateToForm(page) {
            closeFormsMenuModal();
            showLoading(true);
            google.script.run.withSuccessHandler(function(url) {
                window.top.location.href = url + '?page=' + page;
            }).getBaseUrl();
        }
    </script>
</body>
</html>